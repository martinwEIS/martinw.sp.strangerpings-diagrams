
'Component Diagram Acceptance Criteria :
'https://confluence.epnet.com/x/QJXHE

@startuml

skinparam componentStyle rectangle
skinparam fontsize 10
skinparam StereotypeFontSize 10
skinparam roundCorner 20

skinparam node<<newNode>> {
    BackgroundColor #A4CCAC
}

skinparam legend {
    FontSize 20
    BorderThickness 4
}

skinparam title {
    BorderRoundCorner 10
    BorderThickness 2
    titleBorderColor DimGray
    titleFontSize 60
}

title ELK AWS LZ  <color:#F7ABAB>**(New Proposed Design)**</color>

header: EPA.Stranger-Pings (2021-03-24)

footer: https://github.com/EBSCOIS/platform.infrastructure.elk/tree/master/docs

legend bottom left
    * New Component           = <color:#A4CCAC>**GREEN**</color>
    * Modified Component     = <color:#ADBBD2>**BLUE**</color>
    * Unmodified Component = <color:#FFFFFF>**WHITE**</color>
    * Deprecated Component = <color:#F7ABAB>**RED**</color>
end legend

caption Version 1.0

rectangle "eis-lz-shared-devqa" <<Account>> as acctSharedDevQa {

    rectangle "shared-devqa" <<VPC>> as vpcSHQ {

        node "EC2" <<Service>> as ec2SHQ {

            component "Filebeat" as fbSHQ {

                file "filebeat.yaml" as fbyamlSHQ #White
            }
        }

        interface "Data Flow" as dataEntrySHQ #White
        dataEntrySHQ -down-> fbyamlSHQ

        rectangle "\tELK\n\tNOT\nIMPLEMENTED" as noElkSHQ #White
        fbyamlSHQ --> noElkSHQ
    }

    interface "Entry\nPoint" as dataEntrySharedDevQa #White
    dataEntrySharedDevQa --> dataEntrySHQ
}

rectangle "eis-lz-shared" <<Account>> as acctShared {

    rectangle "shared" <<VPC>>  as vpcSH {

        node "EC2" <<Service>> as ec2SH {

            component "Filebeat" as fbSH {

                file "filebeat.yaml" as fbyamlSH #White
            }
        }

        rectangle " " <<Logstash>> as lsSH {

            component lsNlbSH #A4CCAC as "
            \tElastic Load Balancer
            --
            <b>logstash.ehost-devqa.eislz.com</b>
            "

            node "EC2\nC4.xlarge" <<Logstash>> as ls2SH <<newNode>> {

                queue "\tPersistent Queue\n FILTER : add_tag 'shared'" as pq2SH #A4CCAC
            }

            node "EC2\nC4.xlarge" <<Logstash>> as ls1SH <<newNode>> {

                queue "\tPersistent Queue\n FILTER : add_tag 'shared'" as pq1SH #A4CCAC
            }
        }

        rectangle "<b>Domain : es-centralizedlogging</b>" <<Elasticsearch Cluster (Managed)>> as escSH {

            component kibanaSH <<kibana>> #A4CCAC as "
            \t\tKibana UI
            --
            <b>http:\\elk.shared.eislz.com</b>
            "

            component elasticEndpointSH <<endpoint>> #A4CCAC as "
            Elasticsearch Endpoint
            --
            <b>elk.shared.eislz.com</b>
            "

            rectangle "Master Nodes" as masterSH {

                node "  Master\nC5.xlarge" <<elasticsearch>> as mn3SH #A4CCAC
                node "  Master\nC5.xlarge" <<elasticsearch>> as mn2SH #A4CCAC
                node "  Master\nC5.xlarge" <<elasticsearch>> as mn1SH #A4CCAC
            }

            rectangle "Data Nodes" as dataSH {

                database "  Data\nC5.xlarge" <<elasticsearch>> as dn1SH #A4CCAC
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn2SH #A4CCAC
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn3SH #A4CCAC
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn4SH #A4CCAC
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn5SH #A4CCAC
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn6SH #A4CCAC
            }

            interface "  Kibana\nEntry Point " as kibanaEntrySH #White
            kibanaEntrySH -left-> kibanaSH

            kibanaSH -left-> elasticEndpointSH

            elasticEndpointSH --> mn3SH
            elasticEndpointSH --> mn2SH
            elasticEndpointSH --> mn1SH

            dataSH --> dn6SH
            dataSH --> dn5SH
            dataSH --> dn4SH
            dataSH --> dn3SH
            dataSH --> dn2SH
            dataSH --> dn1SH

            mn3SH --> dataSH
            mn2SH --> dataSH
            mn1SH --> dataSH
        }

        fbyamlSH -down-> lsNlbSH
        lsNlbSH --> pq1SH
        lsNlbSH --> pq2SH
        pq1SH --> elasticEndpointSH
        pq2SH --> elasticEndpointSH

        interface " " as dataEntrySH #White
        dataEntrySH -down-> fbyamlSH
    }

    interface "Entry\nPoint" as dataEntryShared #White
    dataEntryShared --> dataEntrySH
}

rectangle "eis-lz-ehost-devqa" <<Account>> as acctEhostDevQa {

    rectangle "ehost-devqa" <<VPC>>  as vpcQ {

        node "EC2" <<Service>> as ec2Q {

            component "Filebeat" as fbQ {

                file "filebeat.yaml" as fbyamlQ #White
            }
        }

        rectangle " " <<Logstash>> as lsQ  {

            component lsNlbQ #White as "
            \tElastic Load Balancer
            --
            <b>logstash.ehost-devqa.eislz.com</b>
            "

            node "EC2\nC4.xlarge" <<Logstash>> as ls2Q #LightSteelBlue {

                queue "\tPersistent Queue\n FILTER : add_tag 'ehost-devqa'" as pq2Q #LightSteelBlue
            }

            node "EC2\nC4.xlarge" <<Logstash>> as ls1Q #LightSteelBlue {

                queue "\tPersistent Queue\n FILTER : add_tag 'ehost-devqa'" as pq1Q #LightSteelBlue
            }
        }

        rectangle "<b>Domain : es-centralizedlogging</b>" <<Elasticsearch Cluster (Managed)>> as escQ #line:red;line.bold {

            component kibanaQ <<kibana>> #F7ABAB as "
            \t\tKibana UI
            --
            <b>http:\\elk.ehost-devqa.eislz.com</b>
            "

            component elasticEndpointQ <<endpoint>> #F7ABAB as "
            Elasticsearch Endpoint
            --
            <b>elk.ehost-devqa.eislz.com</b>
            "

            rectangle "Master Nodes" as masterQ #line:red;line.bold {

                node "  Master\nC5.xlarge" <<elasticsearch>>  as mn3Q #F7ABAB
                node "  Master\nC5.xlarge" <<elasticsearch>>  as mn2Q #F7ABAB
                node "  Master\nC5.xlarge" <<elasticsearch>>  as mn1Q #F7ABAB
            }

            rectangle "Data Nodes" as dataQ #line:red;line.bold {
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn1Q #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn2Q #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn3Q #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn4Q #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn5Q #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn6Q #F7ABAB
            }

            interface "  Kibana\nEntry Point " as kibanaEntryQ #White
            kibanaEntryQ -left-> kibanaQ

            kibanaQ -left-> elasticEndpointQ

            elasticEndpointQ --> mn3Q
            elasticEndpointQ --> mn2Q
            elasticEndpointQ --> mn1Q

            dataQ --> dn6Q
            dataQ --> dn5Q
            dataQ --> dn4Q
            dataQ --> dn3Q
            dataQ --> dn2Q
            dataQ --> dn1Q

            mn3Q --> dataQ
            mn2Q --> dataQ
            mn1Q --> dataQ
        }

        component redirectSharedQ #A4CCAC as "
        \t<b>REDIRECT</b>
        ==
        \teis-lz-shared
        Elasticsearch Endpoint
        <b>elk.shared.eislz.com</b>
        "

        fbyamlQ -down-> lsNlbQ
        lsNlbQ --> pq1Q
        lsNlbQ --> pq2Q
        pq1Q --> redirectSharedQ
        pq2Q --> redirectSharedQ
        redirectSharedQ --> elasticEndpointQ #line:white;line.bold

        interface " " as dataEntryQ #White
        dataEntryQ -down-> fbyamlQ
    }

    interface "Entry\nPoint" as dataEntryEhostDevQa #White
    dataEntryEhostDevQa --> dataEntryQ
}

rectangle "eis-lz-ehost-integration" <<Account>> as acctEhostInt {

    rectangle "ehost-int" <<VPC>>  as vpcI {

        node "EC2" <<Service>> as ec2I {

            component "Filebeat" as fbI {

                file "filebeat.yaml" as fbyamlI #White
            }
        }

        rectangle " " <<Logstash>> as lsI {

            component lsNlbI #A4CCAC  as "
            \tElastic Load Balancer
            --
            <b>logstash.ehost-live.eislz.com</b>
            "

            node "EC2\nC4.xlarge" <<Logstash>> as ls1I #A4CCAC {

                queue "\tPersistent Queue\n FILTER : add_tag 'ehost-int'" as pq1I #A4CCAC
            }

            node "EC2\nC4.xlarge" <<Logstash>> as ls2I #A4CCAC {

                queue "\tPersistent Queue\n FILTER : add_tag 'ehost-int'" as pq2I #A4CCAC
            }
        }

        component redirectSharedI #A4CCAC as "
        \t<b>REDIRECT</b>
        ==
        \teis-lz-shared
        Elasticsearch Endpoint
        <b>elk.shared.eislz.com</b>
        "

        interface "Data Flow" as dataEntryI #White
        dataEntryI -down-> fbyamlI

        fbyamlI --> lsNlbI
        lsNlbI --> pq1I
        lsNlbI --> pq2I
        pq1I --> redirectSharedI
        pq2I --> redirectSharedI

    }

    interface "Entry\nPoint" as dataEntryEhostInt #White
    dataEntryEhostInt --> dataEntryI
}

rectangle "eis-lz-ehost-live" <<Account>> as acctEhostLive {

    rectangle "ehost-live-sigma" <<VPC>>  as vpcSi {

        node "EC2" <<Service>> as ec2Si {

            component "Filebeat" as fbSi {

                file "filebeat.yaml" as fbyamlSi #White
            }
        }

        rectangle " " <<Logstash>> as lsSi {

            component lsNlbSi #A4CCAC  as "
            \tElastic Load Balancer
            --
            <b>logstash.ehost-live.eislz.com</b>
            "

            node "EC2\nC4.xlarge" <<Logstash>> as ls1Si #A4CCAC {

                queue "\tPersistent Queue\n FILTER : add_tag 'ehost-live-sigma'" as pq1Si #A4CCAC
            }

            node "EC2\nC4.xlarge" <<Logstash>> as ls2Si #A4CCAC {

                queue "\tPersistent Queue\n FILTER : add_tag 'ehost-live-sigma'" as pq2Si #A4CCAC
            }
        }

        component redirectSharedSi #A4CCAC as "
        \t<b>REDIRECT</b>
        ==
        \teis-lz-shared
        Elasticsearch Endpoint
        <b>elk.shared.eislz.com</b>
        "

        interface " " as dataEntrySi #White
        dataEntrySi -down-> fbyamlSi

        fbyamlSi -down-> lsNlbSi
        lsNlbSi --> pq1Si
        lsNlbSi --> pq2Si

        pq1Si --> redirectSharedSi
        pq2Si --> redirectSharedSi


    }

    rectangle "ehost-live-pi" <<VPC>>  as vpcPi {

        node "EC2" <<Service>> as ec2Pi {

            component "Filebeat" as fbPi {

                file "filebeat.yaml" as fbyamlPi #White
            }
        }

        rectangle " " <<Logstash>> as lsPi {

            component lsNlbPi #White as "
            \tElastic Load Balancer
            --
            <b>logstash.ehost-live.eislz.com</b>
            "

            node "EC2\nC4.xlarge" <<Logstash>> as ls1Pi #LightSteelBlue {

                queue "\tPersistent Queue\n FILTER : add_tag 'ehost-live-pi'" as pq1Pi #LightSteelBlue
            }

            node "EC2\nC4.xlarge" <<Logstash>> as ls2Pi #LightSteelBlue {

                queue "\tPersistent Queue\n FILTER : add_tag 'ehost-live-pi'" as pq2Pi #LightSteelBlue
            }
        }

        rectangle "<b>Domain : es-centralizedlogging</b>" <<Elasticsearch Cluster (Managed)>> as escPii #line:red;line.bold {

            component kibanaPi <<kibana>> #F7ABAB as "
            \t\tKibana UI
            --
            <b>http:\\elk.ehost-live.eislz.com</b>
            "

            component elasticEndpointPi <<endpoint>> #F7ABAB as "
            Elasticsearch Endpoint
            --
            <b>elk.ehost-live.eislz.com</b>
            "

            rectangle "Master Nodes" as masterPi #line:red;line.bold {

                node "  Master\nC5.xlarge" <<elasticsearch>>  as mn3Pi #F7ABAB
                node "  Master\nC5.xlarge" <<elasticsearch>>  as mn2Pi #F7ABAB
                node "  Master\nC5.xlarge" <<elasticsearch>>  as mn1Pi #F7ABAB
            }

            rectangle "Data Nodes" as dataPi #line:red;line.bold {

                database "  Data\nC5.xlarge" <<elasticsearch>> as dn1Pi #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn2Pi #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn3Pi #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn4Pi #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn5Pi #F7ABAB
                database "  Data\nC5.xlarge" <<elasticsearch>> as dn6Pi #F7ABAB
            }

            interface "  Kibana\nEntry Point " as kibanaEntryPi #White
            kibanaEntryPi -left-> kibanaPi

            kibanaPi -left-> elasticEndpointPi

            elasticEndpointPi --> mn3Pi
            elasticEndpointPi --> mn2Pi
            elasticEndpointPi --> mn1Pi

            dataPi --> dn6Pi
            dataPi --> dn5Pi
            dataPi --> dn4Pi
            dataPi --> dn3Pi
            dataPi --> dn2Pi
            dataPi --> dn1Pi

            mn3Pi --> dataPi
            mn2Pi --> dataPi
            mn1Pi --> dataPi
        }

        component redirectSharedPi #A4CCAC as "
        \t<b>REDIRECT</b>
        ==
        \teis-lz-shared
        Elasticsearch Endpoint
        <b>elk.shared.eislz.com</b>
        "

        fbyamlPi -down-> lsNlbPi
        lsNlbPi --> pq1Pi
        lsNlbPi --> pq2Pi
        pq1Pi --> redirectSharedPi
        pq2Pi --> redirectSharedPi
        redirectSharedPi --> elasticEndpointPi #line:white;line.bold

        interface " " as dataEntryPi #White
        dataEntryPi -down-> fbyamlPi
    }

    interface "Entry\nPoint" as dataEntryEhostLive #White
    dataEntryEhostLive --> dataEntryPi
    dataEntryEhostLive --> dataEntrySi
}

@enduml